(function(a){"use strict";function b(a,b,c){var d=null,e=null,f=null;if(window.Blob?(d=new Blob([a],{type:"text/xml"}),e=window.URL.createObjectURL(d)):f="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(a),navigator.msSaveBlob)navigator.msSaveBlob(d,c);else if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(d,c);else{var g=document.createElement("a");g.setAttribute("href",window.Blob?e:f),g.setAttribute("download",c||"graph."+b),document.body.appendChild(g),g.click(),document.body.removeChild(g)}e&&setTimeout(function(){window.URL.revokeObjectURL(e)},0)}function c(a,b){return null===b?null:b.split(".").reduce(function(a,b){return a[b]},a)}function d(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:null}function e(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return b<10&&(b="0"+b),c<10&&(c="0"+c),d+"-"+c+"-"+b}function f(a){return a===+a&&a===(0|a)}function g(a,b){return"integer"===b&&"number"==typeof a?f(a)||(b="float"):"number"!=typeof a&&(b="string","boolean"==typeof a&&(b="boolean")),b}if("undefined"==typeof sigma)throw"sigma.exporters.gexf: sigma is not declared";sigma.prototype.toGEXF=function(a){a=a||{};var f,h=document.implementation.createDocument("","",null),i=new XMLSerializer,j="",k=!0,l=this.graph.nodes(),m=this.graph.edges();if(a.renderer&&(k=a.renderer instanceof sigma.renderers.webgl,f=k?a.renderer.camera.prefix:a.renderer.camera.readPrefix),a.filterHidden){var n=function(a){return!a.hidden};l=l.filter(n),m=m.filter(n)}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I={},J=0,K={},L=0;E=h.createElement("gexf"),E.setAttribute("xmlns","http://www.gexf.net/1.2draft"),E.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),E.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),E.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),E.setAttribute("version","1.2"),B=h.createElement("meta"),B.setAttribute("lastmodifieddate",e()),a.creator&&(w=h.createElement("creator"),H=h.createTextNode(""+a.creator),w.appendChild(H),B.appendChild(w)),a.description&&(x=h.createElement("description"),H=h.createTextNode(""+a.description),x.appendChild(H),B.appendChild(x)),A=h.createElement("graph"),A.setAttribute("mode","static"),C=h.createElement("nodes");for(var M=0;M<l.length;M++){if(o=l[M],D=h.createElement("node"),D.setAttribute("id",o.id),o.label&&D.setAttribute("label",o.label),p=c(o,a.nodeAttributes),p&&(r=h.createElement("attvalues"),Object.keys(p).forEach(function(a){a in I||(I[a]={id:J,type:"integer"},J++);var b=p[a];I[a].type=g(b,I[a].type),s=h.createElement("attvalue"),s.setAttribute("for",I[a].id),s.setAttribute("value",b),r.appendChild(s)}),D.appendChild(r)),a.renderer){if(o.color){var N;N="#"===o.color[0]?d(o.color):o.color.match(/\d+/g),N.length>2&&(v=h.createElement("viz:color"),v.setAttribute("r",N[0]),v.setAttribute("g",N[1]),v.setAttribute("b",N[2]),N.length>3&&(5===N.length?v.setAttribute("a",N[3]+"."+N[4]):v.setAttribute("a",N[3])),D.appendChild(v))}F=h.createElement("viz:position"),F.setAttribute("x",o[f+"x"]),F.setAttribute("y",-parseInt(o[f+"y"],10)),D.appendChild(F),o.size&&(G=h.createElement("viz:size"),G.setAttribute("value",o[f+"size"]),D.appendChild(G))}C.appendChild(D)}t=h.createElement("attributes"),t.setAttribute("class","node"),Object.keys(I).forEach(function(a){q=h.createElement("attribute"),q.setAttribute("id",I[a].id),q.setAttribute("title",a),q.setAttribute("type",I[a].type),t.appendChild(q)}),y=h.createElement("edges");for(var M=0;M<m.length;M++){if(o=m[M],z=h.createElement("edge"),z.setAttribute("id",o.id),z.setAttribute("source",o.source),z.setAttribute("target",o.target),o.size&&z.setAttribute("weight",o.size),o.label&&z.setAttribute("label",o.label),p=c(o,a.edgeAttributes),p&&(r=h.createElement("attvalues"),Object.keys(p).forEach(function(a){a in K||(K[a]={id:L,type:"integer"},L++);var b=p[a];K[a].type=g(b,K[a].type),s=h.createElement("attvalue"),s.setAttribute("for",K[a].id),s.setAttribute("value",b),r.appendChild(s)}),z.appendChild(r)),a.renderer){if(o.color){var N;N="#"===o.color[0]?d(o.color):o.color.match(/\d+/g),N.length>2&&N.length<=5&&(v=h.createElement("viz:color"),v.setAttribute("r",N[0]),v.setAttribute("g",N[1]),v.setAttribute("b",N[2]),z.appendChild(v))}o.size&&(G=h.createElement("viz:size"),G.setAttribute("value",o.size),z.appendChild(G))}y.appendChild(z)}return u=h.createElement("attributes"),u.setAttribute("class","edge"),Object.keys(K).forEach(function(a){q=h.createElement("attribute"),q.setAttribute("id",K[a].id),q.setAttribute("title",a),q.setAttribute("type",K[a].type),u.appendChild(q)}),A.appendChild(t),A.appendChild(u),A.appendChild(C),A.appendChild(y),E.appendChild(B),E.appendChild(A),h.appendChild(E),j=i.serializeToString(h),a.download&&b(j,"gexf",a.filename),q&&q.parentNode.removeChild(q),r&&r.parentNode.removeChild(r),s&&s.parentNode.removeChild(s),v&&v.parentNode.removeChild(v),w&&w.parentNode.removeChild(w),x&&x.parentNode.removeChild(x),H&&H.parentNode.removeChild(H),F&&F.parentNode.removeChild(F),G&&G.parentNode.removeChild(G),D&&D.parentNode.removeChild(D),z&&z.parentNode.removeChild(z),t&&t.parentNode.removeChild(t),u&&u.parentNode.removeChild(u),C&&C.parentNode.removeChild(C),y&&y.parentNode.removeChild(y),A&&A.parentNode.removeChild(A),B&&B.parentNode.removeChild(B),E&&E.parentNode.removeChild(E),h=null,j}}).call(this);