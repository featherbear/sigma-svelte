(function(a){"use strict";function b(a){var b=";base64,";if(a.indexOf(b)==-1){var c=a.split(","),d=c[0].split(":")[1],e=decodeURIComponent(c[1]);return new Blob([e],{type:d})}for(var c=a.split(b),d=c[0].split(":")[1],e=window.atob(c[1]),f=e.length,g=new Uint8Array(f),h=0;h<f;++h)g[h]=e.charCodeAt(h);return new Blob([g],{type:d})}function c(a,c,d){if(d=d||"graph."+c,navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(b(a),d);else if(navigator.msSaveBlob)navigator.msSaveBlob(b(a),d);else{var e=document.createElement("a");e.setAttribute("href",a),e.setAttribute("download",d),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}function d(a,b,c){var d=Math.min(c/a,c/b);return{width:a*d,height:b*d}}function e(a,b,c){var d;return d=sigma.utils.getBoundaries(a.graph,b.camera.readPrefix),d.minX/=c.zoomRatio,d.minY/=c.zoomRatio,d.maxX/=c.zoomRatio,d.maxY/=c.zoomRatio,d}function f(a,b,c){var f,g=c.margin||0,h={width:b.width,height:b.height};return c.clips||c.size?c.size&&c.size>=1&&(h=d(b.width,b.height,c.size)):(f=e(a,b,c),h={width:f.maxX-f.minX+2*f.sizeMax,height:f.maxY-f.minY+2*f.sizeMax}),h.width+=g,h.height+=g,h}function g(a,b,d){if(d=d||{},d.format&&!(d.format in k))throw Error('sigma.renderers.image: unsupported format "'+d.format+'".');var e=f(a,b,d),g=a.settings("batchEdgesDrawing");g&&a.settings("batchEdgesDrawing",!1),d.clip||h(a,d,e);var j=i(b,d,e);a.settings("batchEdgesDrawing",g);var l=j.toDataURL(k[d.format||"png"]);return d.download&&c(l,d.format||"png",d.filename),l}function h(a,b,c){b.tmpContainer=b.tmpContainer||"image-container";var d=sigma.utils.getPixelRatio(),e=a.settings("webglOversamplingRatio"),f=document.getElementById(b.tmpContainer);f||(f=document.createElement("div"),f.id=b.tmpContainer,document.body.appendChild(f)),f.setAttribute("style","width:"+Math.round(c.width/d)+"px;height:"+Math.round(c.height/d)+"px;");var g=a.addRenderer({container:document.getElementById(b.tmpContainer),type:"canvas",settings:{batchEdgesDrawing:!0,drawLabels:!!b.labels}});g.camera.ratio=b.zoomRatio>0?b.zoomRatio:1,b.size||(g.camera.ratio*=d);var h=g instanceof sigma.renderers.webgl,i=!1,k=[];l=document.createElement("canvas"),m=l.getContext("2d"),a.refresh(),j.forEach(function(a){if(g.contexts[a]&&(b.labels!==!1||"labels"!==a)){var d=g.domElements[a]||g.domElements.scene,f=g.contexts[a];i||(l.width=c.width,l.height=c.height,h&&f instanceof WebGLRenderingContext&&(l.width/=e,l.height/=e),i=!0),f instanceof WebGLRenderingContext?m.drawImage(d,0,0,d.width/e,d.height/e):m.drawImage(d,0,0),~k.indexOf(f)||k.push(f)}}),k=[],a.killRenderer(g),f.parentNode.removeChild(f)}function i(a,b,c){var e=a instanceof sigma.renderers.webgl,f=!1,g=[],h=document.createElement("canvas"),i=h.getContext("2d");return j.forEach(function(j){if(a.contexts[j]&&(b.labels!==!1||"labels"!==j)){var k=a.domElements[j]||a.domElements.scene,m=a.contexts[j];if(!~g.indexOf(m)){if(!f){var n,o;if(b.clip){var p=!b.size||b.size<1?window.innerWidth:b.size;n=k.width,o=k.height,c=d(n,o,p)}else n=l.width,o=l.height;if(h.width=c.width,h.height=c.height,!e&&!m instanceof WebGLRenderingContext){var q=s.settings("webglOversamplingRatio");h.width*=q,h.height*=q}f=!0,b.background&&(i.rect(0,0,h.width,h.height),i.fillStyle=b.background,i.fill())}i.drawImage(b.clip?k:l,0,0,h.width,h.height),g.push(m)}}}),g=[],h}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var j,k,l,m;j=["scene","edges","nodes","labels"],k={png:"image/png",jpg:"image/jpeg",gif:"image/gif",tiff:"image/tiff"},sigma.plugins.image=g,sigma.plugins.image.bind(this)}).call(this);